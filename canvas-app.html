<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI智能制课画布</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- 状态一：任务指令界面 -->
        <div id="mission-briefing" class="mission-briefing">
            <div class="mission-card">
                <h1 class="mission-title">🎨 AI智能制课画布</h1>
                <p class="mission-subtitle">描述您的培训目标，AI将在画布上生长出完整的课程知识图谱</p>
                
                <textarea 
                    id="instruction-input" 
                    class="instruction-input" 
                    placeholder="为新入职的产品经理，制作一门关于团队管理的培训课程，包含沟通技巧、项目管理、团队激励等核心内容，时长90分钟。"
                ></textarea>

                <div class="upload-zone" id="upload-zone">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">拖拽素材文件到此处或点击上传</div>
                    <div class="upload-text" style="font-size: 14px; color: #a0aec0;">支持 PPT, PDF, DOCX, TXT 格式</div>
                    <input type="file" id="file-input" multiple accept=".ppt,.pptx,.pdf,.docx,.txt" style="display: none;">
                </div>

                <div id="file-list" class="file-list"></div>

                <button id="generate-canvas-btn" class="generate-btn">🚀 在画布上生成课程</button>
            </div>
        </div>

        <!-- 状态二：画布工作区 -->
        <div id="canvas-workspace" class="canvas-workspace">
            <!-- 画布工具栏 -->
            <div class="canvas-toolbar">
                <button class="tool-btn" id="zoom-in" title="放大">🔍+</button>
                <button class="tool-btn" id="zoom-out" title="缩小">🔍-</button>
                <button class="tool-btn" id="fit-screen" title="适应屏幕">📐</button>
                <button class="tool-btn" id="reset-view" title="重置视图">🏠</button>
                <div class="toolbar-divider"></div>
                <button class="tool-btn primary" id="preview-course" title="预览课程">👁️</button>
                <button class="tool-btn primary" id="generate-courseware" title="生成课件">📄</button>
            </div>

            <!-- 画布容器 -->
            <div id="canvas-container" class="canvas-container">
                <div id="canvas" class="canvas">
                    <!-- 节点将动态插入到这里 -->
                </div>
            </div>

            <!-- 加载动画 -->
            <div id="loading-overlay" class="loading-overlay">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">AI正在画布上生成课程结构...</div>
                </div>
            </div>
        </div>

        <!-- AI工具箱 -->
        <div id="ai-toolbox" class="ai-toolbox">
            <div class="toolbox-header">
                <span class="toolbox-title">🤖 AI协同工具</span>
                <button class="close-btn" onclick="closeToolbox()">×</button>
            </div>
            <div class="toolbox-content">
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="quickAction('expand')">📝 扩写内容</button>
                    <button class="quick-action-btn" onclick="quickAction('simplify')">✂️ 精简内容</button>
                    <button class="quick-action-btn" onclick="quickAction('quiz')">❓ 生成测验</button>
                    <button class="quick-action-btn" onclick="quickAction('case')">📚 添加案例</button>
                </div>
                <div class="micro-chat">
                    <textarea id="chat-input" class="chat-input" placeholder="对本节有什么具体要求？" rows="2"></textarea>
                    <button class="chat-send-btn" onclick="sendChatMessage()">发送</button>
                </div>
            </div>
        </div>

        <!-- 上下文菜单 -->
        <div id="context-menu" class="context-menu">
            <div class="context-menu-item" onclick="contextAction('edit')">✏️ 编辑标题</div>
            <div class="context-menu-item" onclick="contextAction('addChild')">➕ 添加子节点</div>
            <div class="context-menu-item" onclick="contextAction('duplicate')">📋 复制节点</div>
            <div class="context-menu-item" onclick="contextAction('delete')">🗑️ 删除节点</div>
        </div>

        <!-- 提示框 -->
        <div id="tooltip" class="tooltip"></div>

        <!-- 课程预览模态框 -->
        <div id="course-preview-modal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h2>📖 课程预览</h2>
                    <button class="close-btn" onclick="closePreviewModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="course-preview-content" class="course-preview">
                        <!-- 预览内容将动态生成 -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn secondary" onclick="closePreviewModal()">返回编辑</button>
                    <button class="btn primary" onclick="generateCourseware()">生成课件</button>
                </div>
            </div>
        </div>

        <!-- 课件生成模态框 -->
        <div id="courseware-modal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h2>📄 课件生成与交付</h2>
                    <button class="close-btn" onclick="closeCoursewareModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="courseware-options">
                        <div class="option-group">
                            <h3>📊 课件格式选择</h3>
                            <div class="format-options">
                                <label class="format-option">
                                    <input type="checkbox" value="ppt" checked>
                                    <span class="checkmark"></span>
                                    <div class="option-info">
                                        <strong>📊 PowerPoint演示文稿</strong>
                                        <p>完整的PPT课件，包含讲师备注</p>
                                    </div>
                                </label>
                                <label class="format-option">
                                    <input type="checkbox" value="pdf" checked>
                                    <span class="checkmark"></span>
                                    <div class="option-info">
                                        <strong>📄 PDF培训手册</strong>
                                        <p>学员学习手册，便于打印分发</p>
                                    </div>
                                </label>
                                <label class="format-option">
                                    <input type="checkbox" value="word">
                                    <span class="checkmark"></span>
                                    <div class="option-info">
                                        <strong>📝 Word培训大纲</strong>
                                        <p>详细的培训计划和教学指导</p>
                                    </div>
                                </label>
                                <label class="format-option">
                                    <input type="checkbox" value="quiz">
                                    <span class="checkmark"></span>
                                    <div class="option-info">
                                        <strong>❓ 配套测验题库</strong>
                                        <p>自动生成的考核题目</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="option-group">
                            <h3>🎯 交付选项</h3>
                            <div class="delivery-options">
                                <label class="delivery-option">
                                    <input type="radio" name="delivery" value="download" checked>
                                    <span class="radio-mark"></span>
                                    <div class="option-info">
                                        <strong>💾 本地下载</strong>
                                        <p>将课件打包下载到本地</p>
                                    </div>
                                </label>
                                <label class="delivery-option">
                                    <input type="radio" name="delivery" value="email">
                                    <span class="radio-mark"></span>
                                    <div class="option-info">
                                        <strong>📧 邮件发送</strong>
                                        <p>直接发送到指定邮箱</p>
                                    </div>
                                </label>
                                <label class="delivery-option">
                                    <input type="radio" name="delivery" value="cloud">
                                    <span class="radio-mark"></span>
                                    <div class="option-info">
                                        <strong>☁️ 云端分享</strong>
                                        <p>生成分享链接，便于团队协作</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="option-group" id="email-options" style="display: none;">
                            <h3>📧 邮件设置</h3>
                            <div class="email-form">
                                <input type="email" id="recipient-email" placeholder="接收人邮箱地址" class="form-input">
                                <textarea id="email-message" placeholder="附加消息（可选）" rows="3" class="form-input"></textarea>
                            </div>
                        </div>
                    </div>

                    <div id="generation-progress" class="generation-progress" style="display: none;">
                        <div class="progress-header">
                            <h3>🚀 正在生成课件...</h3>
                            <div class="progress-status" id="progress-status">准备中...</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-details" id="progress-details">
                            <div class="detail-item">
                                <span class="detail-icon">📊</span>
                                <span class="detail-text">PPT课件</span>
                                <span class="detail-status pending" id="ppt-status">等待中</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-icon">📄</span>
                                <span class="detail-text">PDF手册</span>
                                <span class="detail-status pending" id="pdf-status">等待中</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-icon">❓</span>
                                <span class="detail-text">测验题库</span>
                                <span class="detail-status pending" id="quiz-status">等待中</span>
                            </div>
                        </div>
                    </div>

                    <div id="generation-complete" class="generation-complete" style="display: none;">
                        <div class="success-header">
                            <div class="success-icon">✅</div>
                            <h3>🎉 课件生成完成！</h3>
                            <p>您的培训课件已准备就绪</p>
                        </div>
                        <div class="file-list" id="generated-files">
                            <!-- 生成的文件列表将在这里显示 -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn secondary" onclick="closeCoursewareModal()">关闭</button>
                    <button class="btn primary" id="start-generation" onclick="startGeneration()">开始生成</button>
                    <button class="btn primary" id="download-all" onclick="downloadAll()" style="display: none;">📥 下载全部</button>
                </div>
            </div>
        </div>

        <!-- 课程Review模态框 -->
        <div id="review-modal" class="modal">
            <div class="modal-content extra-large">
                <div class="modal-header">
                    <h2>🔍 课程整体Review</h2>
                    <button class="close-btn" onclick="closeReviewModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="review-layout">
                        <div class="review-sidebar">
                            <div class="review-nav">
                                <button class="nav-item active" data-tab="structure">📋 结构检查</button>
                                <button class="nav-item" data-tab="content">📝 内容审核</button>
                                <button class="nav-item" data-tab="quality">⭐ 质量评估</button>
                                <button class="nav-item" data-tab="suggestions">💡 优化建议</button>
                            </div>
                        </div>
                        <div class="review-content">
                            <div id="review-structure" class="review-tab active">
                                <h3>📋 课程结构分析</h3>
                                <div class="structure-analysis">
                                    <div class="analysis-item">
                                        <div class="item-header">
                                            <span class="status-icon success">✅</span>
                                            <strong>课程完整性</strong>
                                        </div>
                                        <p>课程包含4个主要章节，结构完整，逻辑清晰</p>
                                    </div>
                                    <div class="analysis-item">
                                        <div class="item-header">
                                            <span class="status-icon success">✅</span>
                                            <strong>时长分配</strong>
                                        </div>
                                        <p>总时长90分钟，各章节时长分配合理</p>
                                    </div>
                                    <div class="analysis-item">
                                        <div class="item-header">
                                            <span class="status-icon warning">⚠️</span>
                                            <strong>知识点密度</strong>
                                        </div>
                                        <p>第二章知识点较密集，建议适当精简或分拆</p>
                                    </div>
                                </div>
                            </div>
                            <div id="review-content" class="review-tab">
                                <h3>📝 内容质量审核</h3>
                                <div class="content-review">
                                    <div class="review-section">
                                        <h4>✅ 内容覆盖度</h4>
                                        <div class="coverage-chart">
                                            <div class="coverage-item">
                                                <span>理论知识</span>
                                                <div class="progress-bar mini">
                                                    <div class="progress-fill" style="width: 85%"></div>
                                                </div>
                                                <span>85%</span>
                                            </div>
                                            <div class="coverage-item">
                                                <span>实践案例</span>
                                                <div class="progress-bar mini">
                                                    <div class="progress-fill" style="width: 70%"></div>
                                                </div>
                                                <span>70%</span>
                                            </div>
                                            <div class="coverage-item">
                                                <span>互动环节</span>
                                                <div class="progress-bar mini">
                                                    <div class="progress-fill" style="width: 60%"></div>
                                                </div>
                                                <span>60%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="review-quality" class="review-tab">
                                <h3>⭐ 质量评估报告</h3>
                                <div class="quality-metrics">
                                    <div class="metric-card">
                                        <div class="metric-score">8.5</div>
                                        <div class="metric-label">整体评分</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-score">90%</div>
                                        <div class="metric-label">内容完整度</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-score">85%</div>
                                        <div class="metric-label">逻辑清晰度</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-score">75%</div>
                                        <div class="metric-label">实用性</div>
                                    </div>
                                </div>
                            </div>
                            <div id="review-suggestions" class="review-tab">
                                <h3>💡 AI优化建议</h3>
                                <div class="suggestions-list">
                                    <div class="suggestion-item high">
                                        <div class="suggestion-priority">高</div>
                                        <div class="suggestion-content">
                                            <strong>增加互动环节</strong>
                                            <p>建议在每章结束后添加小组讨论或案例分析，提高学员参与度</p>
                                            <button class="apply-suggestion" onclick="applySuggestion('interaction')">应用建议</button>
                                        </div>
                                    </div>
                                    <div class="suggestion-item medium">
                                        <div class="suggestion-priority">中</div>
                                        <div class="suggestion-content">
                                            <strong>补充实践案例</strong>
                                            <p>第三章项目管理部分可以添加更多实际项目案例</p>
                                            <button class="apply-suggestion" onclick="applySuggestion('cases')">应用建议</button>
                                        </div>
                                    </div>
                                    <div class="suggestion-item low">
                                        <div class="suggestion-priority">低</div>
                                        <div class="suggestion-content">
                                            <strong>优化视觉设计</strong>
                                            <p>建议使用更多图表和视觉元素来辅助理解</p>
                                            <button class="apply-suggestion" onclick="applySuggestion('visual')">应用建议</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn secondary" onclick="closeReviewModal()">关闭</button>
                    <button class="btn primary" onclick="showCoursewareModal()">确认生成课件</button>
                </div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="canvas-engine.js"></script>
    <script src="app.js"></script>
    <script src="courseware-generator.js"></script>
</body>
</html>